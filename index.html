<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calcolatore Anti-Bolletta | Risparmia sull'energia</title>
  <meta name="description"
    content="Scopri quanto puoi risparmiare sulle tue bollette di luce, gas e internet con il Metodo 3F.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
  <!-- CDN Dependencies for GitHub Pages compatibility -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<body>
  <div id="app">
    <div class="progress-container">
      <div id="progress-bar" class="progress-bar"></div>
    </div>

    <div class="container">

      <!-- Screen 1: Welcome -->
      <div id="screen-1" class="screen welcome-screen active">
        <div class="badge-bonus">Bonus Esclusivo Ebook</div>
        <img src="./logo.png" alt="Logo Anti-Bolletta" style="width: 120px; margin-bottom: 20px;">
        <h1>Sistema Anti-Bolletta</h1>
        <p class="subtitle">
          Questa applicazione ti permette di <strong>applicare correttamente il Metodo 3F</strong>
          sulla tua situazione reale, evitando gli errori pi√π comuni che fanno fallire il risparmio.
        </p>
        <button class="btn" id="btn-start" onclick="nextScreen()">Inizia Analisi 3F</button>
      </div>

      <!-- Screen 2: Region (NUOVA POSIZIONE) -->
      <div id="screen-2" class="screen">
        <p class="step-indicator">Fase 1 ‚Äì Metodo 3F: Filtrare</p>
        <h2>Dove vivi in Italia?</h2>
        <p class="subtitle">Le tariffe variano per regione. Indica la tua per calcoli precisi.</p>

        <div class="form-group">
          <label for="regione-select">Seleziona la tua regione</label>
          <select id="regione-select">
            <option value="" disabled selected>Scegli...</option>
            <!-- Options will be populated by JS -->
          </select>
        </div>

        <button class="btn" id="btn-next-2" onclick="nextScreen()">Continua</button>
        <button class="btn btn-secondary" onclick="prevScreen()">Indietro</button>
      </div>

      <!-- Screen 3: Current Data (SPOSTATA) -->
      <div id="screen-3" class="screen">
        <p class="step-indicator">Fase 1 ‚Äì Metodo 3F: Filtrare</p>
        <h2>Quanto stai pagando adesso?</h2>
        <p class="subtitle">Inserisci le tue spese medie mensili per identificare sprechi nascosti.</p>

        <div class="form-group">
          <label for="spesa-luce">Spesa media mensile LUCE (‚Ç¨)</label>
          <input type="number" id="spesa-luce" placeholder="Es. 80">
          <p class="hint">Guarda l'ultima bolletta per un dato preciso</p>
          <div style="margin-top: 8px; padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;">
            <label style="font-size: 12px; opacity: 0.8;" for="prezzo-luce-manuale">Prezzo al kWh (OPZIONALE)</label>
            <input type="number" id="prezzo-luce-manuale" placeholder="es. 0.45" step="0.01">
          </div>
        </div>

        <div class="form-group">
          <label for="spesa-gas">Spesa media mensile GAS (‚Ç¨)</label>
          <input type="number" id="spesa-gas" placeholder="Es. 120">
          <p class="hint">Se non hai gas (solo induzione), inserisci 0</p>
          <div style="margin-top: 8px; padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;">
            <label style="font-size: 12px; opacity: 0.8;" for="prezzo-gas-manuale">Prezzo al m¬≥ (OPZIONALE)</label>
            <input type="number" id="prezzo-gas-manuale" placeholder="es. 1.25" step="0.01">
          </div>
        </div>

        <div class="form-group">
          <label for="spesa-internet">Internet e Telefonia (‚Ç¨)</label>
          <input type="number" id="spesa-internet" placeholder="Es. 35">
          <p class="hint">Adsl, Fibra, SIM, ecc.</p>
        </div>

        <button class="btn" id="btn-next-3" onclick="nextScreen()">Continua</button>
        <button class="btn btn-secondary" onclick="prevScreen()">Indietro</button>
      </div>

      <!-- Screen 4: Contract Type -->
      <div id="screen-4" class="screen">
        <p class="step-indicator">Fase 1 ‚Äì Metodo 3F: Filtrare</p>
        <h2>Qual √® il tuo tipo di contratto?</h2>
        <p class="subtitle">La struttura del tuo contratto nasconde spesso costi fissi (PCV) fuori mercato.</p>

        <div class="radio-group" id="contratto-group">
          <label class="option-card" id="opt-tutelato" onclick="selectOption('tipoContratto', 'Tutelato', this)">
            <input type="radio" name="contratto" value="Tutelato">
            <div style="flex:1">
              <strong>Mercato Tutelato</strong>
              <p class="hint">Prezzi ARERA (In via di superamento)</p>
            </div>
          </label>
          <label class="option-card" id="opt-libero" onclick="selectOption('tipoContratto', 'Libero', this)">
            <input type="radio" name="contratto" value="Libero">
            <div style="flex:1">
              <strong>Mercato Libero</strong>
              <p class="hint">Fornitore Privato (Possibili Rimodulazioni)</p>
            </div>
          </label>
          <label class="option-card" id="opt-nonso" onclick="selectOption('tipoContratto', 'Non so', this)">
            <input type="radio" name="contratto" value="Non so">
            <div style="flex:1">
              <strong>Non lo so</strong>
            </div>
          </label>
        </div>

        <button class="btn" id="btn-next-4" onclick="nextScreen()">Continua</button>
        <button class="btn btn-secondary" onclick="prevScreen()">Indietro</button>
      </div>

      <!-- Screen 5: Usage Profile -->
      <div id="screen-5" class="screen">
        <p class="step-indicator">Fase 3 ‚Äì Metodo 3F: Frequenza (quando intervenire)</p>
        <h2>Quando usi pi√π energia?</h2>
        <p class="subtitle">Adatta il tuo stile di consumo per proteggere il risparmio nel lungo periodo.</p>

        <div class="radio-group" id="profilo-group">
          <label class="option-card" id="opt-diurno" onclick="selectOption('profilo', 'Diurno', this)">
            <input type="radio" name="profilo" value="Diurno">
            <div style="flex:1">
              <strong>Mattina/Pomeriggio (8-18)</strong>
              <p class="hint">Lavoro da casa o pensionati</p>
            </div>
          </label>
          <label class="option-card" id="opt-notturno" onclick="selectOption('profilo', 'Notturno', this)">
            <input type="radio" name="profilo" value="Notturno">
            <div style="flex:1">
              <strong>Sera/Notte (18-8)</strong>
              <p class="hint">Torni a casa tardi e usi elettrodomestici di notte</p>
            </div>
          </label>
          <label class="option-card" id="opt-sempre" onclick="selectOption('profilo', 'Sempre', this)">
            <input type="radio" name="profilo" value="Sempre">
            <div style="flex:1">
              <strong>Sempre presente in casa</strong>
            </div>
          </label>
        </div>

        <button class="btn" id="btn-next-5" onclick="nextScreen()">Continua</button>
        <button class="btn btn-secondary" onclick="prevScreen()">Indietro</button>
      </div>

      <!-- Screen 6: Accessory Services -->
      <div id="screen-6" class="screen">
        <p class="step-indicator">Fase 2 ‚Äì Metodo 3F: Focalizzare</p>
        <h2>Hai servizi accessori?</h2>
        <p class="subtitle">Identifica ogni servizio extra che gonfia le tue fatture senza darti valore reale.</p>

        <div class="checkbox-group" id="servizi-group">
          <!-- Servizi from data.js will be populated here -->
        </div>

        <button class="btn" id="btn-next-6" onclick="nextScreen()">Continua</button>
        <button class="btn btn-secondary" onclick="prevScreen()">Indietro</button>
      </div>

      <!-- Screen 7: Seasonality Adjustment (NUOVA!) -->
      <div id="screen-7" class="screen">
        <p class="step-indicator">Fase 3 ‚Äì Metodo 3F: Frequenza (Stagionalit√†)</p>
        <h2 id="seasonality-title">Verifichiamo la stagionalit√† della tua regione</h2>
        <div id="seasonality-estimate-box" class="info-box" style="margin-bottom: 20px;">
          <!-- Content populated by JS -->
        </div>

        <div class="radio-group" id="stagionalita-group">
          <label class="option-card" id="opt-precise" onclick="selectOption('fattoreAggiustamento', 1.0, this)">
            <input type="radio" name="stagionalita" value="1.0">
            <div style="flex:1">
              <strong>S√¨, √® preciso</strong>
            </div>
          </label>
          <label class="option-card" id="opt-colder" onclick="selectOption('fattoreAggiustamento', 1.2, this)">
            <input type="radio" name="stagionalita" value="1.2">
            <div style="flex:1">
              <strong>No, il mio inverno √® PI√ô FREDDO</strong>
              <p class="hint">(costi il 50%+ in pi√π)</p>
            </div>
          </label>
          <label class="option-card" id="opt-warmer" onclick="selectOption('fattoreAggiustamento', 0.6, this)">
            <input type="radio" name="stagionalita" value="0.6">
            <div style="flex:1">
              <strong>No, il mio inverno √® MENO FREDDO</strong>
              <p class="hint">(costi il 20-30% in pi√π)</p>
            </div>
          </label>
          <label class="option-card" id="opt-mild" onclick="selectOption('fattoreAggiustamento', 0.0, this)">
            <input type="radio" name="stagionalita" value="0.0">
            <div style="flex:1">
              <strong>No, vivo in zona molto mite</strong>
              <p class="hint">(inverno costumi normali)</p>
            </div>
          </label>
        </div>

        <button class="btn" id="btn-analyze" onclick="analyze()">Applica Aggiustamento</button>
        <button class="btn btn-secondary" onclick="prevScreen()">Indietro</button>
      </div>


      <!-- Screen 8: Results -->
      <div id="screen-8" class="screen">
        <h1>I Tuoi Risultati</h1>

        <!-- SEZIONE A: SITUAZIONE ATTUALE -->
        <div class="result-card">
          <div class="result-header">üìä LA TUA SITUAZIONE ATTUALE</div>
          <div class="result-body" id="attuale-summary-new">
            <!-- Filled by JS -->
          </div>
        </div>

        <!-- NUOVA SEZIONE: ANALISI TARIFFA PERSONALE -->
        <div class="result-card info-card">
          <div class="result-header">üí° LA TUA TARIFFA REALE vs MEDIA</div>
          <div class="result-body" id="analisi-tariffa-content">
            <!-- Filled by JS -->
          </div>
        </div>

        <!-- SEZIONE B: AREE DI MIGLIORAMENTO -->
        <div class="result-card">
          <div class="result-header">üéØ SPRECHI IDENTIFICATI</div>
          <div class="result-body" id="sprechi-list-new">
            <!-- Filled by JS -->
          </div>
        </div>

        <!-- SEZIONE C: GRAFICO E DETTAGLIO MENSILE -->
        <div class="result-card">
          <div class="result-header">üìà SIMULAZIONE MESE PER MESE</div>
          <div class="result-body">
            <div class="chart-container">
              <canvas id="savingsChart"></canvas>
            </div>
            <div id="monthly-details" class="monthly-details-grid">
              <!-- Filled by JS -->
            </div>
          </div>
        </div>

        <!-- SEZIONE D: RIEPILOGO ANNUALE -->
        <div class="result-card highlighted-card">
          <div class="result-header">üí∞ IL TUO POTENZIALE DI RISPARMIO</div>
          <div class="result-body" id="riepilogo-annuale">
            <!-- Filled by JS -->
          </div>
        </div>

        <!-- SEZIONE E: AZIONI PRIORITARIE -->
        <div class="result-card">
          <div class="result-header">‚úÖ COSA FARE ADESSO</div>
          <div class="result-body" id="azioni-list-new">
            <!-- Filled by JS -->
          </div>
        </div>

        <!-- SEZIONE F: COME HO CALCOLATO (COLLAPSIBLE) -->
        <div class="result-card">
          <details class="methodology-details">
            <summary class="result-header" style="cursor:pointer; list-style: none;">üìñ Come ho calcolato questi numeri?
            </summary>
            <div class="result-body" id="metodologia-content">
              <!-- Filled by JS -->
            </div>
          </details>
        </div>

        <!-- SISTEMA DI MONITORAGGIO 3F -->
        <div class="monitoring-card" id="monitoring-section">
          <div class="timing-badge">MOMENTO IDEALE PER IL MONITORAGGIO</div>
          <h3>üõ°Ô∏è Sistema di Monitoraggio Temporale 3F</h3>
          <p style="font-size: 13px; opacity: 0.8; margin-bottom: 15px; font-style: italic;">"Questo sistema non prende
            decisioni al posto tuo: ti avvisa solo quando √® il momento giusto per rivedere la situazione."</p>
          <p style="font-size: 14px; opacity: 0.9;">Questo √® uno dei momenti in cui il <strong>Metodo 3F</strong> va
            riapplicato. Attiva gli alert per non perdere il controllo del timing.</p>

          <div class="monitoring-grid">
            <input type="email" id="monitor-email" class="monitoring-input" placeholder="La tua email">
            <input type="text" id="monitor-expiry" class="monitoring-input"
              placeholder="Scadenza contratto (es. 12/2025)">
          </div>

          <button class="btn btn-monitoring" onclick="activateMonitoring()">ATTIVA SCUDO TEMPORALE</button>

          <p class="monitoring-note">Il Sistema di Alert serve a delegare la memoria al codice, permettendoti di
            focalizzarti sulla decisione solo quando il tempismo √® corretto. Nessun abbonamento, supporto puro al Metodo
            3F.</p>
        </div>

        <p class="hint" style="margin-top:12px; text-align: center; color: #444; margin-bottom: 20px;">
          Nota: questi risultati sono validi se applicati nel <strong>momento giusto</strong>.
          Anticipare o rimandare le decisioni pu√≤ annullare parte del risparmio.
        </p>

        <!-- SEZIONE G: PULSANTI FINALI -->
        <div class="final-buttons-grid">
          <button class="btn" onclick="generatePDF()">üì• SCARICA REPORT PDF</button>
          <button class="btn btn-secondary" onclick="alert('Risultati Salvati!')">üíæ SALVA I TUOI RISULTATI</button>
          <button class="btn btn-secondary" onclick="alert('Inviato alla tua email!')">üìß INVIA A EMAIL</button>
          <button class="btn btn-outline" onclick="resetCalculator()">‚Ü©Ô∏è NUOVO CALCOLO</button>
        </div>
      </div>


    </div>
    <div class="footer-app">
      Basato sul Metodo 3F - Sistema Anti-Bolletta &copy; 2026
    </div>
  </div>

  <!-- Hidden element for PDF capture -->
  <div id="pdf-content"
    style="position: absolute; left: -9999px; width: 600px; padding: 40px; background: white; font-family: sans-serif;">
    <!-- Filled before capture -->
  </div>

  <script src="./data.js"></script>
  <script src="./main.js"></script>
</body>

</html>